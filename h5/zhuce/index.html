<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
    <title>注册</title>
    <script>
        document.documentElement.style.fontSize = Math.min(innerWidth / 20, 24) + 'px'
    </script>
    <link href="http://robinfin.robinjf.com/robin/public/reg/main.a75bfa40633a78cb85a976a0273756f2.css" rel="stylesheet">
    <link rel="stylesheet" href="css/LArea.min.css">
</head>
<body>
	<div class="register">
		<div class="pb-10"></div>
		<div class="bg-box-1 py-20 por">
            <div class="poa w-100 t-0 mt-12 logo-reg py-20"></div>
        </div>
        <div class="form-reg bg-box-2 px-13 pt-20">
            <div class="mb-7 fz-md">我是 <span id="nickname">王子铭</span>，邀请你加入Robin Fin</div>
            <input type="text" hidden="" class="input" id="code" name="code" value="O95Z8A">
            <div class="ctrl-wrap mb-7">
                <input type="text" name="realName" id="realName" class="input" placeholder="请输入你的昵称">
            </div>
            <div class="ctrl-wrap mb-7">
                <input type="text" name="phone" id="phone" class="input input-tel" placeholder="请输入手机号码">
            </div>
            <div class="flex space-between mb-7">
                <div class="ctrl-wrap flex-1 mr-5">
                    <input type="text" name="securityCode" id="securityCode" class="input" placeholder="请输入验证码">
                </div>
                <button type="button" class="btn btn-sms btn-primary" id="getcode" onclick="sandSms()">获取验证码</button>
            </div>
            <div class="ctrl-wrap mb-7 address">
                <div class="ctrl-wrap flex-1"> 
                    <input type="text" name="address" id="address" class="input" placeholder="点击选择地区" value="北京市">
                    <input type="hidden" id="addressVal"  value="北京市">
                </div>
            </div>    
            <div class="ctrl-wrap mb-7">
                <input type="password" name="password" id="password" class="input input-pwd" placeholder="请输入密码">
            </div> 
            <div class="mt-12 mb-10">
                <button onclick="submitNewSign()" class="btn w-100 c-f fz-md btn-submit">确认注册</button>
            </div>
            <div class="tac light-2 fz-sm pb-10">
                <span>——</span> <span class="px-5">Robin Fin</span> <span>——</span>
            </div>
        </div>	
	</div>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/LArea.js"></script>
<script src="js/LAreaData1.js"></script>
<script src="js/LAreaData2.js"></script>
<script>
    $(function(){
        // getName();
        var area1 = new LArea();
        area1.init({
            'trigger': '#address', //触发选择控件的文本框，同时选择完毕后name属性输出到该位置
            'valueTo': '#addressVal', //选择完毕后id属性输出到该位置
            'keys': {
                id: 'id',
                name: 'name'
            }, //绑定数据源相关字段 id对应valueTo的value属性输出 name对应trigger的value属性输出
            'type': 1, //数据源类型
            'data': LAreaData //数据源
        });
        area1.value=[1,13,3];//控制初始位置，注意：该方法并不会影响到input的value
    })
    
    // 确认注册
	function submitNewSign(){
        var url = "http://api.robinjf.com/Client/newSign";
        if( '' == $('#phone').val()){
            alert("请输入手机号");return;
        }
        if( '' == $('#password').val()){
            alert("请输入密码");return;
        }
        if( '' == $('#realName').val()){
            alert("请输入昵称");return;
        }
        var data = {
            code         : $('#code').val(),
            phone        : $('#phone').val(),
            securityCode : $('#securityCode').val(),
            password     : $('#password').val(),
            realName     : $('#realName').val()
        };
        $.ajax({
            type: "post",
            url: url,
            dataType: "json",
            data: data,
            error: function (res) {
                console.log(res);
                alert(res.responseJSON.error_msg);
            },
            success: function (str) {
                if (str.is_succ) {
                    alert(str.error_msg);
                    /*跳转到app或者安卓下载页*/
                    var u = navigator.userAgent;
				    var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
				    var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
				    if (isAndroid) {
				        window.location.href = "https://fir.im/hc4k";// 蒲公英下载
				    } else if (isiOS) {
				        window.location.href = "https://fir.im/xl5w";
				    }
                } else {
                    alert(str.error_msg);
                }
            }
        });
    }
    // 获取验证码
    function sandSms() {
        // 异步获取签名
        var url = "http://api.robinjf.com/Sms/send";
        var data = {
            psmsRecnum : $('#phone').val()
        };
        $.ajax({
            type: "post",
            url: url,
            dataType: "json",
            data: data,
            error: function (res) {
                alert(res.responseJSON.error_msg);
            },
            success: function (str) {
                if (str.is_succ)
                {
                    settime('#getcode');
                } else {
                    alert(str.error_msg);
                }
            }
        });
    }
    var countdown=60;
    // 
    function settime(obj) {
        if (countdown == 0) {
            $(obj).attr("disabled",false);
            $(obj).text("获取验证码");
            countdown = 60;
            return;
        } else {
            $(obj).attr("disabled",true);
            $(obj).text("(" + countdown + ") s 重新发送");
            countdown--;
        }
        setTimeout(function() {
            settime(obj) }
        ,1000);
    }
    function getName(){
        $,ajax({
            type: 'POSt',
            url: "",
            dataType:"json",
            data: {}
            success: function(response){
                var data == response.data.data
                if(res.code == 200){
                    var name = $("#nickname");
                    name.html() == data.name
                }else{

                }  
            }
        })
    }
   

</script>
</html>
